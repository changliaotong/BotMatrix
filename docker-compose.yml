services:
  # 1. BotNexus: High-performance WebSocket Gateway & Proxy
  bot-nexus:
    build: 
      context: ./src/BotNexus
    container_name: btnexus
    restart: always
    ports:
      - "3001:3001"  # WebSocket Gateway
      - "5000:5000"  # Web Dashboard / API
    volumes:
      - ./src/BotNexus/data:/app/data
      - ./stats.json:/app/stats.json
      - /var/run/docker.sock:/var/run/docker.sock # Enable Docker Management
    environment:
      - TZ=Asia/Shanghai
      - REDIS_ADDR=${REDIS_ADDR:-192.168.0.126:6379}
      - REDIS_PWD=${REDIS_PWD:-redis_zsYik8}

  # 1.1 System Worker: Global Logic & Commands
  system-worker:
    build:
      context: ./src/BotWorker
    container_name: btsys
    restart: always
    depends_on:
      - bot-nexus
    environment:
      - TZ=Asia/Shanghai
      - BOT_MANAGER_URL=ws://bot-nexus:3001

  # 2. TencentBot: Tencent Official QQ Bot Worker
  tencent-bot:
    build:
      context: ./src/TencentBot
    container_name: btqq
    restart: always
    depends_on:
      - bot-nexus
    volumes:
      - ./src/TencentBot/config.json:/app/config.json
    environment:
      - TZ=Asia/Shanghai
      - NEXUS_ADDR=ws://bot-nexus:3001
      - TENCENT_SANDBOX=true
      # Configuration is loaded from config.json
    ports:
      - "3133:3133" # Expose WebUI (Config Management), Log Viewer & File Server

  # 3. WxBot: WeChat Robot Worker (Python)
  wxbot:
    build: 
      context: ./src/WxBot
    container_name: btwc
    restart: always
    ports:
      - "5001:5001" # WebUI for QR Code Login
      - "3111:3001" # WebSocket for C# Client (Direct Connection)
    depends_on:
      - bot-nexus
    volumes:
      - ./src/WxBot:/app # Map source code for hot-reloading
      - ./src/WxBot/temp:/app/temp # Session files and QR codes
    environment:
      - TZ=Asia/Shanghai
      - MANAGER_URL=ws://bot-nexus:3001
      - BOT_SELF_ID=${BOT_SELF_ID:-1098299491}
      - MANAGER_TOKEN=${MANAGER_TOKEN:-}
    command: ["python", "onebot.py"]

  # 3.1 WxBotGo: WeChat Robot Worker (Go Version)
  wxbot-go:
    build: 
      context: ./src/WxBotGo
    container_name: btwg
    restart: always
    depends_on:
      - bot-nexus
    volumes:
      - ./src/WxBotGo/storage.json:/app/storage.json # Persist login session
    environment:
      - TZ=Asia/Shanghai
      - MANAGER_URL=ws://bot-nexus:3001
      - BOT_SELF_ID=${BOT_SELF_ID:-1098299491}

  # 4. DingTalkBot: DingTalk Webhook/Stream Worker
  dingtalk-bot:
    build:
      context: ./src/DingTalkBot
    container_name: btdt
    restart: always
    depends_on:
      - bot-nexus
    volumes:
      - ./src/DingTalkBot/config.json:/app/config.json
    environment:
      - TZ=Asia/Shanghai
      - NEXUS_ADDR=ws://bot-nexus:3001

  # 5. FeishuBot: Feishu/Lark Enterprise Worker
  feishu-bot:
    build:
      context: ./src/FeishuBot
    container_name: btfs
    restart: always
    depends_on:
      - bot-nexus
    volumes:
      - ./src/FeishuBot/config.json:/app/config.json
    environment:
      - TZ=Asia/Shanghai
      - NEXUS_ADDR=ws://bot-nexus:3001

  # 6. TelegramBot: Telegram Worker
  telegram-bot:
    build:
      context: ./src/TelegramBot
    container_name: bttg
    restart: always
    depends_on:
      - bot-nexus
    volumes:
      - ./src/TelegramBot/config.json:/app/config.json
    environment:
      - TZ=Asia/Shanghai
      - NEXUS_ADDR=ws://bot-nexus:3001

  # 7. DiscordBot: Discord Worker
  discord-bot:
    build:
      context: ./src/DiscordBot
    container_name: btdc
    restart: always
    depends_on:
      - bot-nexus
    volumes:
      - ./src/DiscordBot/config.json:/app/config.json
    environment:
      - TZ=Asia/Shanghai
      - NEXUS_ADDR=ws://bot-nexus:3001

  # 8. SlackBot: Slack Enterprise Worker
  slack-bot:
    build:
      context: ./src/SlackBot
    container_name: btsl
    restart: always
    depends_on:
      - bot-nexus
    volumes:
      - ./src/SlackBot/config.json:/app/config.json
    environment:
      - TZ=Asia/Shanghai
      - NEXUS_ADDR=ws://bot-nexus:3001

  # 9. KookBot: Kook Community Worker
  kook-bot:
    build:
      context: ./src/KookBot
    container_name: btkk
    restart: always
    depends_on:
      - bot-nexus
    volumes:
      - ./src/KookBot/config.json:/app/config.json
    environment:
      - TZ=Asia/Shanghai
      - NEXUS_ADDR=ws://bot-nexus:3001

  # 10. EmailBot: Email Integration Worker
  email-bot:
    build:
      context: ./src/EmailBot
    container_name: btem
    restart: always
    depends_on:
      - bot-nexus
    volumes:
      - ./src/EmailBot/config.json:/app/config.json
    environment:
      - TZ=Asia/Shanghai
      - NEXUS_ADDR=ws://bot-nexus:3001

  # 11. WeWorkBot: Enterprise WeChat Worker
  wework-bot:
    build:
      context: ./src/WeWorkBot
    container_name: btwm
    restart: always
    ports:
      - "5002:8001" # Expose callback port
    depends_on:
      - bot-nexus
    volumes:
      - ./src/WeWorkBot/config.json:/app/config.json
    environment:
      - TZ=Asia/Shanghai
      - NEXUS_ADDR=ws://bot-nexus:3001

  # 12. NapCat: Personal QQ Worker (OneBot 11)
  # napcat:
  #   image: napneko/napcat:latest
  #   container_name: napcat
  #   restart: always
  #   ports:
  #     - "6099:6099" # WebUI
  #   depends_on:
  #     - bot-manager
  #   volumes:
  #     - ./NapCat/config:/app/napcat/config
  #     - ./NapCat/qq:/app/.config/QQ
  #   environment:
  #     - TZ=Asia/Shanghai
  #     - ACCOUNT= # Optional: Fill in your QQ number for auto-login if previously logged in
  #   deploy:
  #     resources:
  #       limits:
  #         memory: 1G
