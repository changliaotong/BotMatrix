<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
</head>
<body>
    <h1>WebSocketè¿žæŽ¥æµ‹è¯•</h1>
    <div id="status">ç­‰å¾…è¿žæŽ¥...</div>
    <div id="log"></div>
    
    <script>
        function log(message) {
            document.getElementById('log').innerHTML += '<br>' + new Date().toLocaleTimeString() + ': ' + message;
        }
        
        function testWebSocket(url, role) {
            log('æ­£åœ¨è¿žæŽ¥ ' + role + ': ' + url);
            
            const ws = new WebSocket(url);
            
            ws.onopen = function() {
                log('âœ… ' + role + ' è¿žæŽ¥æˆåŠŸ');
                document.getElementById('status').innerHTML = role + ' å·²è¿žæŽ¥';
                
                // å‘é€èº«ä»½éªŒè¯
                ws.send(JSON.stringify({
                    type: 'identify',
                    role: role,
                    id: 'test_' + role + '_' + Date.now()
                }));
            };
            
            ws.onmessage = function(event) {
                log('ðŸ“¨ æ”¶åˆ°æ¶ˆæ¯: ' + event.data);
            };
            
            ws.onerror = function(error) {
                log('âŒ è¿žæŽ¥é”™è¯¯: ' + error);
                document.getElementById('status').innerHTML = role + ' è¿žæŽ¥é”™è¯¯';
            };
            
            ws.onclose = function(event) {
                log('ðŸ”Œ è¿žæŽ¥å…³é—­: code=' + event.code + ', reason=' + event.reason);
                document.getElementById('status').innerHTML = role + ' å·²æ–­å¼€';
            };
            
            return ws;
        }
        
        // æµ‹è¯•Workerè¿žæŽ¥
        const workerWs = testWebSocket('ws://192.168.0.115:3001/ws/workers', 'Worker');
        
        // 5ç§’åŽæµ‹è¯•Botè¿žæŽ¥
        setTimeout(() => {
            const botWs = testWebSocket('ws://192.168.0.115:3001/ws/bots', 'Bot');
        }, 5000);
    </script>
</body>
</html>