<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BotMatrix Manager v1.1.87 (Classic)</title>
    <link rel="icon" href="data:,">
    <!-- Load critical CSS -->
    <link href="https://cdn.staticfile.org/twitter-bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.staticfile.org/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css" rel="stylesheet">
    
    <!-- System Shield -->
    <script src="js/shield.js?v=1.1.87"></script>
    
    <!-- Load critical JS libraries -->
    <script src="https://cdn.staticfile.org/twitter-bootstrap/5.1.3/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.staticfile.org/Chart.js/3.7.1/chart.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.staticfile.org/three.js/0.141.0/three.min.js" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/three@0.141.0/examples/js/controls/OrbitControls.js" crossorigin="anonymous"></script>
    
    <!-- App Entry Point -->
    <script type="module" src="js/init.js"></script>
    
    <style>
        :root {
            --bg-body: #f8f9fa;
            --bg-sidebar: #ffffff;
            --bg-card: #ffffff;
            --text-main: #212529;
            --text-muted: #6c757d;
            --border-color: #dee2e6;
            --primary-color: #0d6efd;
            
            --bg-console: #f8f9fa;
            --text-console: #212529;
            --color-log-time: #0d6efd;
            --color-log-info: #198754;
            --color-log-error: #dc3545;
            --color-log-debug: #6c757d;
            
            --bg-list-item: #f8f9fa;
        }

        [data-theme="dark"] {
            --bg-body: #121212;
            --bg-sidebar: #1e1e1e;
            --bg-card: #1e1e1e;
            --text-main: #e0e0e0;
            --text-muted: #adb5bd;
            --border-color: #333333;
            --primary-color: #3d8bfd;

            --bg-console: #1e1e1e;
            --text-console: #d4d4d4;
            --color-log-time: #569cd6;
            --color-log-info: #4ec9b0;
            --color-log-error: #f44747;
            --color-log-debug: #dcdcaa;
            
            --bg-list-item: #2c2c2c;
        }

        /* Dark Mode Overrides */
        [data-theme="dark"] .dropdown-menu {
            background-color: var(--bg-card);
            border-color: var(--border-color);
        }
        [data-theme="dark"] .dropdown-item {
            color: var(--text-main);
        }
        [data-theme="dark"] .dropdown-item:hover {
            background-color: var(--bg-list-item);
            color: var(--text-main);
        }
        [data-theme="dark"] .list-group-item {
            background-color: var(--bg-card);
            color: var(--text-main);
            border-color: var(--border-color);
        }
        /* Fix TAB title background in dark mode */
        [data-theme="dark"] .nav-tabs .nav-link.active {
            background-color: var(--bg-card) !important;
            color: var(--text-main) !important;
            border-color: var(--border-color) var(--border-color) var(--bg-body);
        }
        [data-theme="dark"] .card-header,
        [data-theme="dark"] .card-footer {
            background-color: rgba(255, 255, 255, 0.05) !important;
            border-bottom-color: var(--border-color);
            border-top-color: var(--border-color);
            color: var(--text-main);
        }
        [data-theme="dark"] .bg-white,
        [data-theme="dark"] .bg-light,
        [data-theme="dark"] .table-light {
            background-color: var(--bg-list-item) !important;
            color: var(--text-main) !important;
        }
        [data-theme="dark"] .list-group-item.active {
            background-color: var(--primary-color) !important;
            border-color: var(--primary-color) !important;
            color: #ffffff !important;
        }
        [data-theme="dark"] .nav-tabs .nav-link.active {
            background-color: var(--bg-card) !important;
            color: var(--primary-color) !important;
            border-color: var(--border-color) var(--border-color) var(--bg-card) !important;
        }
        [data-theme="dark"] .modal-content {
            background-color: var(--bg-card);
            border-color: var(--border-color);
            color: var(--text-main);
        }
        [data-theme="dark"] .modal-header {
            border-bottom-color: var(--border-color);
        }
        [data-theme="dark"] .modal-header .btn-close {
            filter: invert(1) grayscale(100%) brightness(200%);
        }
        [data-theme="dark"] .modal-footer {
            background-color: var(--bg-sidebar);
            border-top-color: var(--border-color);
        }
        [data-theme="dark"] .table {
            color: var(--text-main) !important;
            border-color: var(--border-color) !important;
        }
        [data-theme="dark"] .table-striped > tbody > tr:nth-of-type(odd) > * {
            background-color: rgba(255, 255, 255, 0.02) !important;
            color: var(--text-main) !important;
            box-shadow: inset 0 0 0 9999px rgba(255, 255, 255, 0.02) !important;
        }
        [data-theme="dark"] .table-hover > tbody > tr:hover > * {
            background-color: rgba(255, 255, 255, 0.04) !important;
            color: var(--text-main) !important;
            box-shadow: inset 0 0 0 9999px rgba(255, 255, 255, 0.04) !important;
        }
        [data-theme="dark"] .card-header {
            border-bottom: 1px solid var(--border-color) !important;
        }
        [data-theme="dark"] .card-footer {
            border-top: 1px solid var(--border-color) !important;
        }
        [data-theme="dark"] .text-primary { color: #4dabf7 !important; }
        [data-theme="dark"] .text-success { color: #51cf66 !important; }
        [data-theme="dark"] .text-warning { color: #fcc419 !important; }
        [data-theme="dark"] .text-danger { color: #ff6b6b !important; }
        [data-theme="dark"] .text-secondary { color: #adb5bd !important; }
        [data-theme="dark"] .text-muted { color: #868e96 !important; }
        [data-theme="dark"] .border-light { border-color: var(--border-color) !important; }
        [data-theme="dark"] .form-control,
        [data-theme="dark"] .form-select {
            background-color: var(--bg-sidebar) !important;
            border-color: var(--border-color) !important;
            color: var(--text-main) !important;
        }
        [data-theme="dark"] .form-control::placeholder {
            color: #6c757d !important;
        }
        [data-theme="dark"] .card-header.bg-primary,
        [data-theme="dark"] .card-header.bg-warning,
        [data-theme="dark"] .card-header.bg-success,
        [data-theme="dark"] .card-header.bg-danger,
        [data-theme="dark"] .card-header.bg-info,
        [data-theme="dark"] .bg-primary:not(.badge):not(.btn),
        [data-theme="dark"] .bg-warning:not(.badge):not(.btn),
        [data-theme="dark"] .bg-success:not(.badge):not(.btn),
        [data-theme="dark"] .bg-danger:not(.badge):not(.btn),
        [data-theme="dark"] .bg-info:not(.badge):not(.btn) {
            background-color: rgba(255, 255, 255, 0.1) !important;
            color: var(--text-main) !important;
            border-color: var(--border-color) !important;
        }
        [data-theme="dark"] .alert-info {
            background-color: rgba(13, 202, 240, 0.1);
            border-color: rgba(13, 202, 240, 0.2);
            color: #6edff6;
        }
        [data-theme="dark"] .alert-success {
            background-color: rgba(25, 135, 84, 0.1);
            border-color: rgba(25, 135, 84, 0.2);
            color: #75b798;
        }
        [data-theme="dark"] .alert-warning {
            background-color: rgba(255, 193, 7, 0.1);
            border-color: rgba(255, 193, 7, 0.2);
            color: #ffda6a;
        }
        [data-theme="dark"] .alert-danger {
            background-color: rgba(220, 53, 69, 0.1);
            border-color: rgba(220, 53, 69, 0.2);
            color: #ea868f;
        }

        /* Login Page Styles */
        .login-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, #1a1a2e 0%, #0f0f1a 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }
        .login-page.hidden {
            opacity: 0;
            pointer-events: none;
        }
        .login-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-main);
            width: 100%;
            max-width: 400px;
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .sidebar { display: flex; flex-direction: column; height: 100vh; position: fixed; top: 0; left: 0; width: 250px; background-color: var(--bg-sidebar); border-right: 1px solid var(--border-color); padding-top: 20px; z-index: 1000; transition: background-color 0.3s, border-color 0.3s; }
        .card { background-color: var(--bg-card); border: 1px solid var(--border-color); margin-bottom: 10px; box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075); border-radius: 0.75rem; transition: background-color 0.3s, border-color 0.3s; }
        
        .nav-link { color: var(--text-muted); padding: 12px 24px; display: block; text-decoration: none; border-left: 3px solid transparent; transition: all 0.2s; }
        .nav-link:hover, .nav-link.active { color: var(--primary-color); background-color: rgba(13, 110, 253, 0.1); border-left-color: var(--primary-color); font-weight: 500; }
        .nav-section-label { padding: 1rem 1.5rem 0.5rem; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; color: var(--text-muted); letter-spacing: 0.05rem; opacity: 0.7; }
        
        .main-content { margin-left: 250px; padding: 25px; min-height: 100vh; background-color: var(--bg-body); }
        .tab-content { display: none; }
        .tab-content.active-tab { display: block; }
    </style>
</head>
<body>
    <div id="loginPage" class="login-page">
        <div class="login-card shadow-lg rounded-3">
            <div class="text-center mb-4">
                <h2 class="h4 fw-bold">BotMatrix Classic</h2>
                <p class="text-muted small">Legacy Management Interface</p>
            </div>
            <form id="loginForm">
                <div class="mb-3">
                    <label class="form-label small fw-bold text-uppercase" for="loginUser">Username</label>
                    <input type="text" id="loginUser" class="form-control" required placeholder="Enter username">
                </div>
                <div class="mb-4">
                    <label class="form-label small fw-bold text-uppercase" for="loginPass">Password</label>
                    <input type="password" id="loginPass" class="form-control" required placeholder="••••••••">
                </div>
                <div id="loginError" class="alert alert-danger d-none small p-2 mb-3 text-center"></div>
                <button type="submit" class="btn btn-primary w-100 py-3 fw-bold shadow-sm">
                    <span id="loginBtnText">AUTHENTICATE</span>
                    <span id="loginBtnLoading" class="d-none">
                        <span class="spinner-border spinner-border-sm me-2"></span>
                        AUTHENTICATING...
                    </span>
                </button>
            </form>
        </div>
    </div>

    <div class="main-app" style="display: none;">
        <div class="sidebar">
            <div class="px-4 mb-4">
                <h5 class="fw-bold mb-0">BotMatrix</h5>
                <small class="text-muted">Classic Edition</small>
            </div>
            <div class="nav-section-label">Main</div>
            <a href="#dashboard" class="nav-link active" id="nav-dashboard">Dashboard</a>
            <a href="#bots" class="nav-link" id="nav-bots">Nodes & Bots</a>
            <a href="#groups" class="nav-link" id="nav-groups">Group Chats</a>
            <a href="#friends" class="nav-link" id="nav-friends">Friends</a>
            
            <div class="nav-section-label">System</div>
            <a href="#monitor" class="nav-link" id="nav-monitor">Monitor</a>
            <a href="#docker" class="nav-link" id="nav-docker">Docker</a>
            <a href="#routing" class="nav-link" id="nav-routing">Routing</a>
            
            <div class="mt-auto p-3 border-top">
                <button class="btn btn-sm btn-outline-danger w-100 fw-bold" onclick="handleLogout()">Logout</button>
            </div>
        </div>

        <div class="main-content">
            <div id="tab-dashboard" class="tab-content active-tab">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3 class="fw-bold m-0">Dashboard</h3>
                    <div class="badge bg-primary px-3 py-2">Classic UI</div>
                </div>
                <div class="row g-4">
                    <div class="col-md-4">
                        <div class="card p-4 border-0 shadow-sm">
                            <div class="text-muted small text-uppercase fw-bold mb-1">Total Nodes</div>
                            <div class="h2 fw-bold mb-0" id="metric-workers">--</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card p-4 border-0 shadow-sm">
                            <div class="text-muted small text-uppercase fw-bold mb-1">Active Bots</div>
                            <div class="h2 fw-bold mb-0" id="metric-bots">--</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card p-4 border-0 shadow-sm">
                            <div class="text-muted small text-uppercase fw-bold mb-1">System Uptime</div>
                            <div class="h2 fw-bold mb-0" id="metric-uptime">--</div>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card p-4 border-0 shadow-sm">
                            <h5 class="fw-bold mb-3">CPU Usage</h5>
                            <div style="height: 200px;">
                                <canvas id="cpuChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card p-4 border-0 shadow-sm">
                            <h5 class="fw-bold mb-3">Memory Usage</h5>
                            <div style="height: 200px;">
                                <canvas id="memChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card mt-4 p-4 border-0 shadow-sm">
                    <h5 class="fw-bold mb-3">Message Flow</h5>
                    <div style="height: 250px;">
                        <canvas id="msgChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div id="tab-bots" class="tab-content">
                <h3 class="fw-bold mb-4">Nodes & Bots</h3>
                <div class="card p-4 border-0 shadow-sm">
                    <div id="bot-list-classic" class="list-group list-group-flush">
                        <div class="text-center py-5 text-muted">Loading bot list...</div>
                    </div>
                </div>
            </div>

            <div id="tab-groups" class="tab-content">
                <h3 class="fw-bold mb-4">Group Chats</h3>
                <div class="card p-4 border-0 shadow-sm">
                    <div class="text-center py-5 text-muted">Select a bot to view groups</div>
                </div>
            </div>

            <div id="tab-friends" class="tab-content">
                <h3 class="fw-bold mb-4">Friends</h3>
                <div class="card p-4 border-0 shadow-sm">
                    <div class="text-center py-5 text-muted">Select a bot to view friends</div>
                </div>
            </div>

            <div id="tab-monitor" class="tab-content">
                <h3 class="fw-bold mb-4">System Monitor</h3>
                <div class="card p-4 border-0 shadow-sm">
                    <div class="log-box" style="height: 500px;">
                        <div class="text-muted">Connecting to logs...</div>
                    </div>
                </div>
            </div>

            <div id="tab-docker" class="tab-content">
                <h3 class="fw-bold mb-4">Docker Management</h3>
                <div class="card p-4 border-0 shadow-sm text-center py-5">
                    <i class="bi bi-cpu h1 text-muted mb-3"></i>
                    <p class="text-muted">Docker integration is available in the modern UI.</p>
                </div>
            </div>

            <div id="tab-routing" class="tab-content">
                <h3 class="fw-bold mb-4">Message Routing</h3>
                <div class="card p-4 border-0 shadow-sm">
                    <div class="text-center py-5 text-muted">Loading routing rules...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Initialization scripts are already present at the end of the file -->
</body>
</html>