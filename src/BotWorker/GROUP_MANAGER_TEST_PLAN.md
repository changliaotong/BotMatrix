# 群管理插件测试计划

## 1. 测试准备

### 1.1 环境要求
- Go 1.25.0 或更高版本
- Redis 服务器（可选，用于管理员权限管理）
- PostgreSQL 数据库（可选，用于持久化存储）

### 1.2 依赖安装
```bash
go mod tidy
go mod download
```

### 1.3 配置文件设置
确保 `config.json` 中的配置正确：
```json
{
  "log": {
    "level": "debug",
    "file": "bot.log",
    "max_size": 10,
    "max_backups": 3,
    "max_age": 28
  },
  "plugin": {
    "dir": "plugins",
    "load_builtin": true
  },
  "database": {
    "host": "localhost",
    "port": 5432,
    "user": "postgres",
    "password": "",
    "dbname": "bot",
    "sslmode": "disable"
  },
  "redis": {
    "host": "localhost",
    "port": 6379,
    "password": "",
    "db": 0
  }
}
```

## 2. 启动方法

### 2.1 使用批处理脚本
```bash
.	est_user_input.bat
```

### 2.2 直接运行Go程序
```bash
go run cmd/main.go
```

## 3. 命令测试列表

### 3.1 设置头衔 `/settitle`

**功能**：设置群成员的头衔

**权限**：群主

**命令格式**：`/settitle <用户ID> <头衔文本>`

**测试用例**：
- ✅ 群主执行：`/settitle 123456 测试头衔`
- ❌ 普通成员执行：`/settitle 123456 测试头衔`
- ✅ 参数检查：无参数、参数不足时的错误提示

### 3.2 踢人 `/kick`

**功能**：将群成员踢出群聊

**权限**：群主、管理员

**命令格式**：`/kick <用户ID>`

**测试用例**：
- ✅ 群主执行：`/kick 123456`
- ✅ 管理员执行：`/kick 123456`
- ❌ 普通成员执行：`/kick 123456`
- ✅ 参数检查：无参数时的错误提示

### 3.3 禁言 `/ban`

**功能**：禁止群成员发言指定时长

**权限**：群主、管理员

**命令格式**：`/ban <用户ID> <时长(秒)>`

**测试用例**：
- ✅ 群主执行：`/ban 123456 60`
- ✅ 管理员执行：`/ban 123456 300`
- ❌ 普通成员执行：`/ban 123456 60`
- ✅ 参数检查：无参数、参数不足时的错误提示

### 3.4 解除禁言 `/unban`

**功能**：解除群成员的禁言状态

**权限**：群主、管理员

**命令格式**：`/unban <用户ID>`

**测试用例**：
- ✅ 群主执行：`/unban 123456`
- ✅ 管理员执行：`/unban 123456`
- ❌ 普通成员执行：`/unban 123456`
- ✅ 参数检查：无参数时的错误提示

### 3.5 添加管理员 `/addadmin`

**功能**：将群成员添加为管理员

**权限**：群主、超级管理员

**命令格式**：`/addadmin <用户ID>`

**测试用例**：
- ✅ 群主执行：`/addadmin 123456`
- ✅ 超级管理员执行：`/addadmin 123456`
- ❌ 普通管理员执行：`/addadmin 123456`
- ❌ 普通成员执行：`/addadmin 123456`
- ✅ 参数检查：无参数时的错误提示

### 3.6 删除管理员 `/deladmin`

**功能**：将群成员从管理员列表中删除

**权限**：群主、超级管理员

**命令格式**：`/deladmin <用户ID>`

**测试用例**：
- ✅ 群主执行：`/deladmin 123456`
- ✅ 超级管理员执行：`/deladmin 123456`
- ❌ 普通管理员执行：`/deladmin 123456`
- ❌ 普通成员执行：`/deladmin 123456`
- ✅ 参数检查：无参数时的错误提示

## 4. 权限测试

### 4.1 群主权限
- 可以执行所有群管理命令
- 可以设置群成员头衔
- 可以踢人、禁言、解除禁言
- 可以添加/删除管理员

### 4.2 管理员权限
- 可以踢人、禁言、解除禁言
- 不能设置群成员头衔
- 不能添加/删除管理员

### 4.3 超级管理员权限
- 可以执行所有群管理命令，不受群限制
- 可以在任何群中添加/删除管理员

### 4.4 普通成员权限
- 不能执行任何群管理命令
- 执行命令时会收到权限不足的提示

## 5. 错误处理测试

### 5.1 参数错误
- 测试无参数的命令
- 测试参数不足的命令
- 测试参数格式错误的命令（如将用户ID输入为字符串）

### 5.2 权限错误
- 测试普通成员执行管理员命令
- 测试管理员执行群主命令

### 5.3 系统错误
- 测试OneBot API调用失败的情况
- 测试数据库/Redis连接失败的情况

## 6. 测试结果记录

| 命令 | 测试用例 | 预期结果 | 实际结果 | 状态 |
|------|----------|----------|----------|------|
| /settitle | 群主执行正确参数 | 成功设置头衔 | | |
| /settitle | 普通成员执行 | 权限不足提示 | | |
| /kick | 管理员执行正确参数 | 成功踢人 | | |
| /kick | 普通成员执行 | 权限不足提示 | | |
| /ban | 群主执行正确参数 | 成功禁言 | | |
| /ban | 参数错误 | 错误提示 | | |
| /unban | 管理员执行正确参数 | 成功解除禁言 | | |
| /addadmin | 群主执行正确参数 | 成功添加管理员 | | |
| /deladmin | 超级管理员执行正确参数 | 成功删除管理员 | | |

## 7. 故障排除

### 7.1 依赖问题
如果遇到依赖缺失错误：
```bash
go mod tidy
go mod download
```

### 7.2 数据库连接问题
确保PostgreSQL服务器正在运行，并且配置文件中的数据库参数正确。

### 7.3 Redis连接问题
确保Redis服务器正在运行，并且配置文件中的Redis参数正确。

### 7.4 日志查看
查看 `bot.log` 文件获取详细的错误信息：
```bash
tail -f bot.log
```

## 8. 结论

群管理插件提供了完整的群管理功能，包括设置头衔、踢人、禁言、解除禁言、添加/删除管理员等。所有功能都有严格的权限控制，确保只有授权用户才能执行相应的操作。

通过执行上述测试用例，可以全面验证群管理插件的功能和安全性。