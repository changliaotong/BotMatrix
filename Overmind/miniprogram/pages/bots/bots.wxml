<!-- æœºå™¨äººç®¡ç†é¡µé¢ -->
<view class="container">
  <!-- æœç´¢å’Œç­›é€‰æ  -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <input 
        class="search-input" 
        placeholder="æœç´¢æœºå™¨äººåç§°ã€IDæˆ–å¹³å°" 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        confirm-type="search"
      />
      <text class="search-icon">ğŸ”</text>
    </view>
  </view>

  <!-- ç­›é€‰å’Œæ’åºå·¥å…·æ  -->
  <view class="filter-toolbar">
    <view class="filter-group">
      <text class="filter-label">çŠ¶æ€:</text>
      <view class="filter-tabs">
        <text 
          class="filter-tab {{statusFilter === 'all' ? 'active' : ''}}" 
          data-status="all"
          bindtap="onStatusFilterChange"
        >å…¨éƒ¨</text>
        <text 
          class="filter-tab {{statusFilter === 'online' ? 'active' : ''}}" 
          data-status="online"
          bindtap="onStatusFilterChange"
        >åœ¨çº¿</text>
        <text 
          class="filter-tab {{statusFilter === 'offline' ? 'active' : ''}}" 
          data-status="offline"
          bindtap="onStatusFilterChange"
        >ç¦»çº¿</text>
        <text 
          class="filter-tab {{statusFilter === 'error' ? 'active' : ''}}" 
          data-status="error"
          bindtap="onStatusFilterChange"
        >é”™è¯¯</text>
      </view>
    </view>
    
    <view class="sort-group">
      <picker bindchange="onSortChange" value="{{sortBy}}" range="{{['name', 'status', 'platform', 'created']}}" range-key="{{['åç§°', 'çŠ¶æ€', 'å¹³å°', 'åˆ›å»ºæ—¶é—´']}}">
        <view class="sort-picker">
          <text>æ’åº: {{sortBy === 'name' ? 'åç§°' : sortBy === 'status' ? 'çŠ¶æ€' : sortBy === 'platform' ? 'å¹³å°' : 'åˆ›å»ºæ—¶é—´'}}</text>
          <text class="sort-arrow">â–¼</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- æ‰¹é‡æ“ä½œå·¥å…·æ  -->
  <view class="batch-toolbar" wx:if="{{isSelecting}}">
    <view class="selection-info">
      <text>å·²é€‰æ‹© {{selectedBots.length}} ä¸ªæœºå™¨äºº</text>
    </view>
    <view class="batch-actions">
      <button 
        class="batch-btn batch-start" 
        size="mini"
        data-operation="start"
        bindtap="batchOperation"
      >å¯åŠ¨</button>
      <button 
        class="batch-btn batch-stop" 
        size="mini"
        data-operation="stop"
        bindtap="batchOperation"
      >åœæ­¢</button>
      <button 
        class="batch-btn batch-restart" 
        size="mini"
        data-operation="restart"
        bindtap="batchOperation"
      >é‡å¯</button>
      <button 
        class="batch-btn batch-cancel" 
        size="mini"
        bindtap="cancelSelection"
      >å–æ¶ˆ</button>
    </view>
  </view>

  <!-- æœºå™¨äººåˆ—è¡¨ -->
  <view class="bot-list" wx:if="{{isLoaded && !isLoading}}">
    <view 
      class="bot-item {{isSelecting && selectedBots.indexOf(item.id) !== -1 ? 'selected' : ''}}" 
      wx:for="{{filteredBots}}" 
      wx:key="id"
      data-id="{{item.id}}"
      bindtap="onBotTap"
      bindlongpress="startSelection"
    >
      <view class="bot-header">
        <view class="bot-info">
          <view class="bot-name-wrapper">
            <text class="bot-name">{{item.name}}</text>
            <text class="bot-id">#{{item.id}}</text>
          </view>
          <view class="bot-platform">
            <text class="platform-badge platform-{{item.platform}}">{{item.platformText}}</text>
          </view>
        </view>
        
        <view class="bot-status">
          <view 
            class="status-indicator" 
            style="background-color: {{item.statusColor}}"
          ></view>
          <text class="status-text" style="color: {{item.statusColor}}">{{item.statusText}}</text>
        </view>
      </view>

      <view class="bot-details">
        <view class="bot-stat">
          <text class="stat-label">ç¾¤ç»„æ•°:</text>
          <text class="stat-value">{{item.groupCount || 0}}</text>
        </view>
        <view class="bot-stat">
          <text class="stat-label">æ¶ˆæ¯æ•°:</text>
          <text class="stat-value">{{item.messageCount || 0}}</text>
        </view>
        <view class="bot-stat">
          <text class="stat-label">æœ€ååœ¨çº¿:</text>
          <text class="stat-value">{{item.lastSeenText}}</text>
        </view>
      </view>

      <view class="bot-actions" wx:if="{{!isSelecting}}">
        <button 
          class="action-btn {{item.status === 'online' ? 'btn-stop' : 'btn-start'}}" 
          size="mini"
          data-id="{{item.id}}"
          bindtap="toggleBotStatus"
        >
          {{item.status === 'online' ? 'åœæ­¢' : 'å¯åŠ¨'}}
        </button>
        <button 
          class="action-btn btn-detail" 
          size="mini"
          data-id="{{item.id}}"
          bindtap="onBotTap"
        >
          è¯¦æƒ…
        </button>
      </view>

      <view class="selection-indicator" wx:if="{{isSelecting}}">
        <view class="checkbox {{selectedBots.indexOf(item.id) !== -1 ? 'checked' : ''}}">
          <text wx:if="{{selectedBots.indexOf(item.id) !== -1}}">âœ“</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{isLoaded && !isLoading && filteredBots.length === 0}}">
    <view class="empty-icon">ğŸ¤–</view>
    <text class="empty-title">æš‚æ— æœºå™¨äºº</text>
    <text class="empty-desc">{{searchKeyword || statusFilter !== 'all' ? 'æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æœºå™¨äºº' : 'è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•æœºå™¨äºº'}}</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">æ­£åœ¨åŠ è½½æœºå™¨äººåˆ—è¡¨...</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-state" wx:if="{{loadError}}">
    <view class="error-icon">âš ï¸</view>
    <text class="error-title">åŠ è½½å¤±è´¥</text>
    <text class="error-desc">{{loadError}}</text>
    <button class="retry-btn" bindtap="loadBots">é‡æ–°åŠ è½½</button>
  </view>

  <!-- åº•éƒ¨æ‰¹é‡é€‰æ‹©æŒ‰é’® -->
  <view class="bottom-actions" wx:if="{{!isSelecting && filteredBots.length > 0}}">
    <button class="batch-select-btn" bindtap="startSelection">
      æ‰¹é‡é€‰æ‹©
    </button>
  </view>
</view>