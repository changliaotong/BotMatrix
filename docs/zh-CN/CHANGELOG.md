# Changelog | 更新日志
[English](../en-US/CHANGELOG.md) | [返回项目主页](../../README.md) | [返回文档中心](../README.md)

所有本项目的重要变更都将记录在此文件中。

## v1.8.0 (2025-12-31)
*   **🗄️ 数据库标准化 (Database Standardization)**:
    - **统一命名规范**: 将全项目所有数据库表名和列名标准化为 `snake_case`（蛇形命名法），解决了历史遗留的命名风格混杂问题，增强了 PostgreSQL 的兼容性。
    - **GORM 模型对齐**: 为所有 GORM 结构体添加了显式的 `column` 标签，并统一了时间戳字段（`created_at`, `updated_at`, `deleted_at`）。
    - **增强成员数据**: 在群成员模型和缓存中增加了 `role` 字段，支持记录群主、管理员及普通成员权限，修复了成员信息获取不全的问题。
*   **🛠️ 代码库同步 (Codebase Synchronization)**:
    - **BotNexus 处理器更新**: 更新了消息处理器逻辑，支持从平台原始事件中提取群成员角色并实时持久化到缓存。
    - **BotWorker 数据库层修复**: 修复了 `db.go` 中硬编码的 SQL 查询，移除了非标准的引号标识符，确保与标准化后的数据库架构无缝对接。
    - **Facade 别名同步**: 同步更新了 `Common/facade.go` 中的 GORM 模型别名，为跨包调用提供了统一的模型访问入口。
*   **📚 文档更新 (Documentation)**:
    - **数据库架构文档**: 创建了详细的 `database_schema.md`，全面记录了系统中所有核心表、AI 表、插件表及缓存表的结构与关联关系。

## v1.7.1 (2025-12-28)
*   **🖼️ 头像标准化 (Avatar Standardization)**:
    - **真实头像集成**: 全面接入 QQ 群和个人真实头像，通过后端代理解决跨域与 Referer 问题。
    - **智能平台 Logo 降级**: 针对非 QQ 协议且用户 ID 大于 980000000000 的场景，自动显示平台 Logo。
    - **全局一致性**: 在机器人列表、联系人、群成员、消息记录及身份映射等所有模块统一头像显示。
    - **后端代理支持**: 引入 `/api/proxy/avatar` 接口，确保头像图片在 WebUI 中稳定加载。

## v1.7.0 (2025-12-27)
*   **🧠 AI 任务调度中心 (AI Task Orchestrator)**:
    - **自然语言解析**: 用户现在可以使用纯中文/英文描述自动化任务（例如：“每天晚上 11 点全群禁言”）。
    - **结构化任务生成**: AI 自动生成基于 cron 的任务，包含正确的动作和参数。
    - **草案与确认流程**: 引入了多步工作流，AI 提议任务，用户在部署前进行确认。
*   **🛡️ 高级路由与安全 (Advanced Routing & Security)**:
    - **策略管理**: 新增了“策略”模块，用于定义复杂的路由策略和可重用的逻辑块。
    - **影子规则**: 实现了非侵入式的消息监控和重定向规则，用于审计和测试。
*   **👤 身份映射系统 (Identity Mapping System)**:
    - **跨平台身份**: 来自不同平台（QQ、微信、Discord）的用户现在可以映射到唯一的“系统身份”。
    - **集中权限管理**: 权限和统计数据现在针对统一身份进行跟踪，而不是碎片化的平台 ID。
*   **🛠️ 界面现代化 (WebUI Modernization)**:
    - **Vue 3 & Pinia 架构**: 重构了核心控制面板，使用 Vue 3 Composition API 和 Pinia 进行极速状态管理。
    - **系统能力发现**: 前端现在通过新的能力 API 动态发现后端动作、拦截器和技能。
*   **📊 实时系统监控 (Real-time System Monitoring)**:
    - **增强的 Docker 集成**: 在控制面板中直接添加了机器人容器的实时 CPU/内存占用跟踪。
    - **Nexus 状态面板**: 实时可视化全局连接统计，包括总机器人、工作节点和系统运行时间。

## v1.6.0 (2025-12-25)
*   **🌌 3D 可视化大修**:
    *   **增强标签**: 增加了节点标签字体大小，提高远距离可见度。
    *   **精灵朝向**: 修复了头像精灵始终面向摄像机，不受节点旋转影响。
    *   **视觉识别**: 改进了针对不同平台的用户/机器人识别与头像处理。
    *   **动态连线**: 引入了全新的蓝色主题连线调色板和动态传输闪烁。
    *   **用户-群组连通性**: 在 3D 空间中增加了用户与其所属群组之间持久、可见的连线。
*   **🛣️ 全路径路由可视化**:
    *   实现了全路径事件可视化：接收消息路径为 `用户 -> 群组 -> Nexus -> Worker`。
*   **📡 智能缓存增强**:
    *   **元数据缓存**: BotNexus 现在会自动从 Napcat 事件中缓存群名和用户昵称。
    *   **消息增强**: 转发的消息在到达 Worker 前会使用缓存的元数据进行增强。
*   **⚙️ 系统可靠性与自动回复**:
    *   **设置持久化**: 修复了 `LogLevel` 和 `AutoReply` 设置无法正确保存到配置文件的关键错误。
    *   **智能自动回复**: 实现了全局 `AutoReply` 逻辑，在系统关闭时自动通知用户维护信息。
*   **🧹 动态 Worker 管理**: 在 3D 可视化中增加了实时状态过滤，确保仅显示在线的 Worker 节点。

## v1.5.0 (2025-12-24)
*   **🐘 PostgreSQL 优先架构**: 完全移除了旧的 SQLite 支持，以简化数据库操作。
*   **🧹 依赖现代化**: 删除了 `modernc.org/sqlite` 及相关的无 CGO SQLite 驱动。
*   **⚙️ 统一配置 WebUI**: 重新设计了 WebUI 中的后端配置界面。
*   **🛡️ 类型安全 API 通信**: 在 WebUI 和 Go 后端中强制执行端口字段的严格数字验证。
*   **🌐 增强的本地化**: 在 `locales.js` 中为所有新的 PostgreSQL 和系统配置字段添加了完整的翻译。

## v1.3.2 (2025-12-22)
*   **🧠 BotWorker 确认与对话引擎**: 在 `BotWorker` 中添加了共享的确认/会话工具层，支持多步对话。
*   **🔊 语音回复与阅后即焚**: 引入了 AI 语音回复和阅后即焚自动撤回功能。
*   **🗄️ 共享持久层**: 在 `Common` 和 `BotWorker` 模块中添加了基于 GORM 的持久层。
*   **📚 文档更新**: 更新了根目录和 BotWorker 文档。

## v1.3.1 (2025-12-22)
*   **🐾 BotWorker 功能扩展**: 引入了全新的 **宠物系统** 插件 (`pets.go`)。
*   **⌨️ 指令解析引擎**: 添加了强大的 `CommandParser` 工具，用于处理结构化的机器人指令。
*   **🛡️ 群组管理测试**: 为群组管理功能实现了全面的测试套件。
*   **🛠️ 开发者工具**: 添加了多个新的测试脚本和 CLI 工具。
*   **📦 集成修复**: 通过解决嵌套 Git 仓库冲突，正式将 `BotWorker` 源码集成到主仓库。

## v1.3.0 (2025-12-22)
*   **🏗️ 架构解耦**: 成功分离了 `BotNexus` (核心网关) 和 `BotAdmin` (管理后端)。
*   **🚀 网关优化**: 从 `BotNexus` 中移除了冗余的 Docker 管理依赖和旧的 Admin HTTP 处理器。
*   **📏 代码标准化**: 在 `Common` 包和处理器中强制执行 PascalCase。
*   **🧹 逻辑整合**: 将重复的统计和监控功能迁移到 `Common` 包。
*   **🔧 路由细化**: 简化了网关中的通配符路由逻辑。

## v1.2.5 (2025-12-21)
*   **🌐 全面的 i18n 修复**: 解决了统计信息、云矩阵排序标签的国际化问题。
*   **�️ 视觉识别恢复**: 在 3D 路由可视化器和列表视图中重新集成了后端头像代理。
*   **👥 鲁棒的群组管理**: 修复了频道型群组的成员列表加载问题。
*   **🎨 UI/UX 优化**: 通过减小卡片间距优化了控制面板布局。
*   **⚡ 实时同步**: 将渲染函数暴露给全局 window 对象，确保 UI 组件即时响应语言变化。

## v1.2.4 (2025-12-20)
*   **📡 Overmind 数据同步**: 修复了 Overmind Flutter 服务中的关键 WebSocket 端口和 API 路径问题。
*   **🔐 无缝身份验证集成**: 为嵌入的 Overmind iframe 实现了自动 JWT 令牌和语言偏好传递。
*   **📐 云矩阵 UI 细化**: 使用全高布局和独立的可滚动列表优化了云矩阵页面。
*   **🚀 自动化部署**: 将 Overmind Flutter Web 构建与 BotNexus 静态文件服务器同步。

## v1.2.3 (2025-12-20)
*   **🌐 实时 i18n 同步**: 修复了路由可视化器在不刷新页面的情况下无法更新语言的问题。
*   **🎨 动态 3D 纹理**: 添加了在语言更改时自动重新生成节点纹理的功能。

## v1.2.2 (2025-12-20)
*   **🛡️ 自删除保护**: 防止管理员删除自己的账户。
*   **⚡ 鲁棒的用户操作**: 修复了用户创建/删除可能提示“失败”但实际成功的关键问题。
*   **📝 改进的审计日志**: 为所有管理员用户管理操作添加了详细的服务端日志。

## v1.2.1 (2025-12-20)
*   **🛠️ 编译修复**: 解决了 `handlers.go` 中 `sendWorkerHeartbeat` 方法的重复声明。
*   **🔢 类型安全**: 修复了 `main.go` 中 `NewManager` 初始化时的 map 类型不匹配。

## v1.2.0 (2025-12-20)
*   **🛡️ Docker 可靠性**: 移除了容器管理中不稳定的 `python:3.9-slim` 镜像回退。
*   **👥 联系人数据一致性**: 修复了群组和好友界面显示缓存数据不带名称/ID 的问题。
*   **🧠 无缝 Overmind 集成**: 嵌入的 Overmind 系统现在支持应用内加载。
*   **🌐 本地化完善**: 解决了主页时间指标的重复 i18n 标签问题。
*   **📐 自适应矩阵布局**: 重构了云矩阵页面的背景逻辑。

## v1.1.99 (2025-12-20)
*   **⚙️ 实时配置面板**: 添加了一个实时设置面板来调整 3D 可视化参数。
*   **💾 持久化设置**: 可视化偏好现在保存到本地存储。
*   **🎨 动态布局引擎**: 重构了定位逻辑。
*   **🛠️ 重置与保存**: 包含了 3D 宇宙的快速重置为默认值和手动保存选项。

## v1.1.98 (2025-12-20)
*   **🌌 星系规模扩张**: 将所有 3D 节点距离和分布半径增加了一个数量级。
*   **🔭 增强的摄像机光学**: 调整了摄像机远平面和缩放限制。
*   **✨ 大规模视觉检修**: 缩放了节点大小、粒子效果、消息提示和星场。
*   **🚀 高速星际旅行**: 针对更大的距离优化了消息粒子速度和虚线尺寸。

## v1.1.97 (2025-12-20)
*   **🌌 动态 Bot-Nexus 距离**: 机器人现在根据其群组数量自动调整与 Nexus 核心的距离。
*   **👥 自适应群组聚类**: 群组到机器人的距离现在随群组总数动态缩放。
*   **🧭 导航持久化**: 修复了刷新“可视化”页面会将用户重定向回控制面板的关键问题。
*   **✨ 平滑实时重定位**: 为节点实现了平滑的 lerp 过渡。

## v1.1.96 (2025-12-20)
*   **🖥️ 全屏模式**: 为 3D 路由图添加了原生全屏支持。
*   **💾 Docker 持久化**: 将数据库存储重构到专用的 `data/` 目录。
*   **🛡️ 权限硬化**: 通过正确配置目录所有权修复了 Docker 中的数据库初始化错误。
*   **🌐 本地化**: 集成了全屏 UI 控件的多语言支持。

## v1.1.95 (2025-12-19)
*   **🌌 3D 群组聚类与持久化同步**:
    *   **👥 群组成员聚类**: 实现了自动空间聚类。
    *   **🌲 树状连线优化**: 优化了 3D 可视化，使用分层连线结构。
    *   **💾 鲁棒的持久化同步**: 为全局消息计数和联系人缓存添加了 SQLite 持久化。
    *   **📡 WebSocket 初始同步**: 为 WebSocket 连接引入了 `SyncState` 协议。
    *   **⏱️ 高级视觉生命周期**: 为消息轨迹和全息提示添加了淡出动画。

## v1.1.94 (2025-12-19)
*   **🖼️ 头像代理**:
    *   **解决跨域问题**: 新增后端头像代理接口 `/api/proxy/avatar`。
    *   **智能切换**: 前端自动通过代理加载外部 URL 头像。

## v1.1.93 (2025-12-19)
*   **⚡ 高速通信特效**:
    *   **🚀 跃迁粒子**: 粒子球现在以 5 倍速度运行。
    *   **🕸️ 虚拟连线**: 在消息交换期间添加了持久的“连线”。
    *   **📍 中点锚定**: 消息文本提示现在锚定在连线的中点。
    *   **⏱️ 基于 TTL 的持久化**: 通信视觉效果现在在淡出前保持 3 秒可见。

## v1.1.92 (2025-12-19)
*   **👤 用户节点强化**:
    *   **🖼️ 头像集成**: 用户头像现在正确显示在 3D 空间中。
    *   **🧲 近距离吸引**: 发送消息的用户现在自动移向 Nexus 中心。
    *   **🌌 动态漂移**: 闲置用户平滑地漂回星系外缘。
    *   **💎 视觉标识**: 为用户节点添加了独特的青色发光效果。

## v1.1.91 (2025-12-19)
*   **🌌 可视化优化**:
    *   **🧹 激进的节点清理**: 离线的 Worker 和 Bot 现在几乎立即从可视化中移除。
    *   **🛡️ 容错保留**: 如果 API 无法返回任何活动节点，添加了简短的宽限期。

## v1.1.90 (2025-12-19)
*   **🌌 可视化与渲染优化**:
    *   **✨ 完整流程可视化**: 添加了缺失的 `bot_to_user` 路由事件。
    *   **🔮 高清晰度全息提示**: 显著提高了全息消息提示的文本清晰度。

## v1.1.89 (2025-12-19)
*   **🌌 3D 可视化精细化与协议鲁棒性**:
    *   **✨ 抖动的 Nexus 核心**: 为中心 Nexus 节点添加了高频抖动效果。
    *   **🌌 动态宇宙缩放**: 闲置用户节点现在平滑地漂移到更远的“外缘”。
    *   **🌠 全轨迹内容同步**: 消息全息提示现在遵循消息粒子的精确 3D 弧线轨迹。
    *   **♾️ 永久用户节点**: 将生命周期管理更改为永久保留用户节点。
    *   **🔧 OneBot 11 Echo 归一化**: 修复了非字符串 `echo` 字段导致类型断言失败的关键问题。
    *   **📡 一致的平台转发**: 为 `RoutingEvent` 添加了缺失的 `platform` 字段。
    *   **🛡️ 未定义变量修复**: 解决了 `handlers.go` 中 `hasEcho` 未定义的问题。
    *   **👥 WxBot 群成员修复**: 修复了 `WxBot` 中的 `get_group_member_info`。

## v1.1.88 (2025-12-19)
*   **🌌 3D 宇宙可视化与负载均衡优化**:
    *   **✨ 3D 路由可视化器**: 将转发路径页面重构为高性能的 Three.js 3D 环境。
    *   **🔮 全息消息提示**: 引入了从节点向上漂浮的动画全息消息提示。
    *   **⚖️ 智能负载均衡**: 升级了 Worker 选择算法，优先考虑 `AvgProcessTime`。
    *   **🖼️ 高科技头像系统**: 实现了受矩阵启发的 3D 节点精灵。
    *   **👤 动态用户聚类**: 将用户节点添加到 3D 空间。
