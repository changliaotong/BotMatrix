# BotMatrix 裂变系统 (Fission System)

> [🌐 English](../en-US/FISSION_SYSTEM.md) | [简体中文](FISSION_SYSTEM.md)
> [⬅️ 返回文档中心](README.md) | [🏠 返回项目主页](../../README.md)

裂变系统是 BotMatrix 的核心增长引擎，通过激励机制引导用户自发邀请好友，实现机器人的病毒式增长。

## 1. 裂变系统文案 (Promotional Copy)

以下文案可用于机器人自动回复或推广海报：

### 1.1 邀请话术
> 🎁 **邀好友，拿大奖！**
> 您的专属邀请码已生成：`【{CODE}】`
> 
> **参与方式：**
> 1. 将此邀请码发送给您的好友。
> 2. 好友添加机器人并发送“`绑定 {CODE}`”。
> 3. 双方均可获得积分奖励，邀请越多，奖励越丰厚！
> 
> 🔗 **专属链接：** {LINK}
> (点击链接即可直接查看邀请进度)

### 1.2 任务奖励文案
> 🎯 **今日裂变任务：**
> - **入群奖励**：加入官方交流群，立得 50 积分！
> - **活跃奖励**：每日使用机器人满 5 次，额外赠送 10 积分。
> - **推广达人**：累计邀请 10 位好友，解锁“推广大使”专属勋章。

---

## 2. 技术文档 (Technical Documentation)

### 2.1 架构设计
裂变系统采用“**中心化管理 + 边缘化执行**”的架构：
- **BotNexus (转发中心)**：负责全局裂变规则配置、全量数据统计、后台管理面板。
- **BotWorker (插件端)**：负责与用户的指令交互、任务进度采集、本地奖励发放逻辑。
- **Service 层**：在 `BotWorker/internal/fission` 中实现了核心业务逻辑，确保插件轻量化。

### 2.2 机器人端指令 (Robot Commands)

| 指令 | 说明 |
| :--- | :--- |
| `邀请` / `邀请码` | 获取个人专属邀请码及推广链接 |
| `绑定 [邀请码]` | 新用户绑定邀请人，领取入场奖励 |
| `奖励` / `进度` | 查看个人邀请人数、积分收益及等级 |
| `裂变榜` | 查看全服邀请人数 Top 10 |
| `任务` | 查看当前可参与的裂变任务及完成情况 |

### 2.3 任务系统 (Task System)
系统内置多种任务类型，支持在后台动态扩展：
- **register (注册任务)**：用户首次成功绑定邀请码。
- **usage (使用任务)**：用户与机器人进行交互（如聊天、使用功能）。
- **group_join (进群任务)**：监听 OneBot `group_increase` 事件，识别用户入群行为。

### 2.4 防刷机制 (Anti-Fraud)
为保证增长质量，系统集成了多重校验：
- **自选限制**：严禁用户绑定自己的邀请码。
- **每日上限**：限制单个用户每日可获得的有效邀请次数。
- **设备/IP 校验**：基于 `CheckInvitationFraud` 接口，识别同设备/同 IP 的虚假刷号行为。

### 2.5 数据模型 (Data Models)
核心数据表：
- `fission_configs`: 存储全局开关、奖励数值、推广模板。
- `user_fission_records`: 存储用户累计邀请量、积分总额、推广等级。
- `invitations`: 记录每一笔真实的邀请绑定关系。
- `fission_tasks`: 存储任务定义。
- `fission_reward_logs`: 完整的奖励发放审计日志。

---

## 3. 开发维护

- **后台 API**：位于 `BotNexus/handlers_fission.go`，前缀为 `/api/admin/fission/`。
- **插件入口**：`BotWorker/plugins/fission.go`。
- **核心逻辑**：`BotWorker/internal/fission/service.go`。

---
*BotMatrix 裂变系统 - 助力每一个机器人走向巅峰*
