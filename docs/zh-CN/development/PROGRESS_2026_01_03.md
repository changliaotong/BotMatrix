# ğŸ› ï¸ æŠ€æœ¯å®ç°æŠ¥å‘Š - 2026-01-03

## 1. ä»»åŠ¡æ¦‚è¿°
åœ¨ 2026-01-03 çš„å¼€å‘ä¼šè¯ä¸­ï¼Œæˆ‘ä»¬å®Œæˆäº†æ•°å­—å‘˜å·¥ç³»ç»Ÿ (Digital Employee System) çš„æ ¸å¿ƒåŠŸèƒ½é—­ç¯ï¼ŒåŒ…æ‹¬è®¤çŸ¥è®°å¿†è‡ªåŠ¨æå–ã€ç»©æ•ˆ/è–ªèµ„ç®¡ç†ã€æŠ€èƒ½æƒé™å¢å¼ºä»¥åŠ B2B ä¼ä¸šçº§æ¡æ‰‹åè®®ã€‚

## 2. æ ¸å¿ƒæ¨¡å—å®ç°è¯¦æƒ…

### 2.1 è®¤çŸ¥è®°å¿†å¼•æ“ (Cognitive Memory)
- **è‡ªåŠ¨æå– (Fact Extraction)**: 
    - å®ç°ç±»: `AIServiceImpl.ExtractAndSaveMemories`
    - é€»è¾‘: åœ¨ AI å¯¹è¯å®Œæˆåï¼Œå¼‚æ­¥å¯åŠ¨ä¸€ä¸ªæå–ä»»åŠ¡ï¼Œåˆ©ç”¨ AI æ€»ç»“å¯¹è¯ä¸­çš„å…³é”®äº‹å®ã€‚
    - å­˜å‚¨: å­˜å…¥ `cognitive_memories` è¡¨ï¼Œæ”¯æŒ `Category` åˆ†ç±»ã€‚
- **æ£€ç´¢æ³¨å…¥**: 
    - é€»è¾‘: åœ¨ `Chat` æ¥å£ä¸­ï¼Œæ ¹æ®å½“å‰ä¸Šä¸‹æ–‡ (`userID`, `botID`) è‡ªåŠ¨æ‰§è¡Œ `GetRelevantMemories`ã€‚
    - å¢å¼º: æ”¯æŒå‘é‡ç›¸ä¼¼åº¦æ£€ç´¢ (éœ€ pgvector) ä¸å…³é”®è¯æ£€ç´¢åŒè·¯å¬å›ã€‚

### 2.2 æ•°å­—å‘˜å·¥ç»©æ•ˆä¸çŠ¶æ€ç®¡ç†
- **åœ¨çº¿çŠ¶æ€è¿½è¸ª**: 
    - é›†æˆç‚¹: `Manager.handleBotWebSocket` ä¸ `Manager.fetchBotInfo`ã€‚
    - åŠŸèƒ½: å½“ Bot å»ºç«‹ WebSocket è¿æ¥æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨ `UpdateOnlineStatus` æ›´æ–°ä¸º `online`ï¼›æ–­å¼€æˆ–å¼‚å¸¸æ—¶æ›´æ–°çŠ¶æ€ã€‚
- **KPI èšåˆç»Ÿè®¡**: 
    - å®ç°: `EmployeeServiceImpl.RecordKpi`ã€‚
    - ç‰¹æ€§: åœ¨è®°å½•å•æ¬¡ KPIï¼ˆå¦‚ `metric="user_rating"`, `score=4.5`ï¼‰åï¼Œè‡ªåŠ¨é€šè¿‡ GORM çš„ `AVG` èšåˆæ›´æ–°å‘˜å·¥ä¸»è¡¨çš„ `kpi_score`ã€‚
- **è™šæ‹Ÿè–ªèµ„æ ¸ç®—**: 
    - é›†æˆç‚¹: `AIServiceImpl.Chat` å¼‚æ­¥å›è°ƒã€‚
    - é€»è¾‘: æ ¹æ® AI å“åº”çš„ `UsageToken` å®æ—¶æ›´æ–° `salary_token` å­—æ®µã€‚

### 2.3 æŠ€èƒ½ç®¡ç†ä¸æƒé™ç³»ç»Ÿ (Skill Manager)
- **å¤šç»´åº¦æƒé™æ ¡éªŒ**: 
    - å®ç°: `SkillManager.CheckPermission`ã€‚
    - æ ¡éªŒå±‚çº§:
        1. ç³»ç»Ÿæ ¸å¿ƒæŠ€èƒ½ (å¦‚ `send_message`) é»˜è®¤æ”¾è¡Œã€‚
        2. MCP å·¥å…·åè§£æ (åŒ…å« `__`)ï¼Œæ ¡éªŒæ‰€å± Org/User çš„ MCP Server æŒ‚è½½æƒé™ã€‚
        3. `bot_skill_permissions` è¡¨çš„æ˜¾å¼æˆæƒè®°å½•ã€‚
- **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**: 
    - æ–°å¢æ¥å£: `GetToolsForContext`ï¼Œå…è®¸æ ¹æ®ä¼šè¯ä¸Šä¸‹æ–‡åŠ¨æ€è¿‡æ»¤å¯ç”¨å·¥å…·ã€‚

### 2.4 ä¼ä¸šé—´åä½œ (B2B Mesh)
- **å®‰å…¨æ¡æ‰‹åè®®**: 
    - å®ç°: `B2BServiceImpl.HandleHandshake`ã€‚
    - æµç¨‹: åŸºäºåŒå‘ JWT ç­¾åæ ¡éªŒï¼ŒéªŒè¯ä¼ä¸šå…¬é’¥èº«ä»½ï¼ŒæˆåŠŸåè‡ªåŠ¨å»ºç«‹äº’ä¿¡è¿æ¥è®°å½•ã€‚

## 3. æ–°å¢ API æ¥å£

| è·¯å¾„ | æ–¹æ³• | æè¿° |
| :--- | :--- | :--- |
| `/api/admin/employees` | GET | åˆ—å‡ºæ‰€æœ‰æ•°å­—å‘˜å·¥æ¡£æ¡ˆ |
| `/api/admin/employees` | POST | åˆ›å»ºæˆ–æ›´æ–°æ•°å­—å‘˜å·¥ä¿¡æ¯ |
| `/api/admin/employees/kpi` | POST | æ‰‹åŠ¨è®°å½•å‘˜å·¥ç»©æ•ˆæŒ‡æ ‡ |
| `/api/admin/memories` | GET | ç®¡ç†åå°æŸ¥è¯¢è®¤çŸ¥è®°å¿†åˆ—è¡¨ |
| `/api/admin/memories/:id` | DELETE | åˆ é™¤é”™è¯¯çš„è®¤çŸ¥è®°å¿†ç‰‡æ®µ |
| `/api/b2b/handshake` | POST | æ¥æ”¶æ¥è‡ªå…¶ä»–ä¼ä¸šçš„æ¡æ‰‹è¯·æ±‚ |

## 4. å…³é”®æ–‡ä»¶å˜æ›´
- [ai_service.go](file:///d:/projects/BotMatrix/src/BotNexus/internal/app/ai_service.go): é›†æˆè®°å¿†æå–ã€RAG æ£€ç´¢ä¸è–ªèµ„ç»Ÿè®¡ã€‚
- [skill_manager.go](file:///d:/projects/BotMatrix/src/BotNexus/internal/app/skill_manager.go): å®ç°ç²¾ç»†åŒ–æƒé™æ ¡éªŒé€»è¾‘ã€‚
- [employee_service.go](file:///d:/projects/BotMatrix/src/BotNexus/internal/app/employee_service.go): ç»©æ•ˆä¸è–ªèµ„çš„åº•å±‚å®ç°ã€‚
- [handlers_admin.go](file:///d:/projects/BotMatrix/src/BotNexus/internal/app/handlers_admin.go): æš´éœ²ç®¡ç† APIã€‚
- [main.go](file:///d:/projects/BotMatrix/src/BotNexus/internal/app/main.go): æ¥å£å®šä¹‰ä¸è·¯ç”±æ³¨å†Œã€‚

## 5. åç»­è§„åˆ’
- [ ] å®ç°è®¤çŸ¥è®°å¿†çš„å®šæœŸâ€œå›ºåŒ–â€ä¸â€œé—å¿˜â€æœºåˆ¶ã€‚
- [ ] å¢å¼º B2B åä½œä¸­çš„è·¨ä¼ä¸šå·¥å…·æµï¼ˆWorkflowï¼‰è°ƒç”¨ã€‚
- [ ] åœ¨ Overmind (ç§»åŠ¨ç«¯) å®ç°æ•°å­—å‘˜å·¥çš„å®æ—¶ç»©æ•ˆçœ‹æ¿ã€‚
