# 👔 数字员工系统 (Digital Employee System)

> [⬅️ 返回文档中心](../README.md) | [🏠 返回项目主页](../../README.md)

## 1. 概念定义
**数字员工 (Digital Employee)** 是 BotMatrix 对 AI 机器人的高级拟人化封装。它不再仅仅是一个执行代码的“机器人实例”，而是一个拥有**工号、职位、部门、人设、技能集以及 KPI 考核**的虚拟雇员。

通过数字员工系统，企业可以将 AI 能力转化为标准化的“人力资源”，像管理真实员工一样管理 AI。

## 2. 核心属性
- **身份化 (Identity)**: 拥有正式的姓名（如：研发助理·小林）和工号。
- **专业化 (Professionalism)**: 明确所属部门（如：质量保证部）和职位等级。
- **人设化 (Persona)**: 通过 `Bio` 字段定义其性格、说话风格和工作态度。
- **记忆化 (Cognitive Memory)**: **[新增]** 具备长期记忆能力，能记住用户的历史偏好与交互事实，确保跨会话的认知连贯。
- **能力化 (MCP Toolset)**: **[新增]** 通过 MCP 协议挂载无限扩展的工具集，不仅能说，更能做。
- **薪酬化 (Cost/Salary)**: 将消耗的 Token 转化为“虚拟薪资”，方便进行 ROI（投资回报率）分析。
- **绩效化 (Performance)**: 建立基于用户评价和处理准确率的 KPI 评分体系。

## 3. 数字员工 HR 管理流程

### 3.1 入职与定岗 (Onboarding)
1. 在系统中选择一个底层机器人实例 (BotID)。
2. 绑定数字员工档案，设定其职位和所属部门。
3. **记忆初始化**: 设定初始认知背景。
4. **Mesh 授权**: 选择是否将该员工发布到 [Global Agent Mesh](GLOBAL_AGENT_MESH.md)，使其具备跨企业协作能力。

### 3.2 岗位培训 (Training)
- **技能挂载**: 通过 MCP 接口挂载专业工具（如：数据库查询、财务报表生成）。
- **语料训练**: 通过“技能训练中心”持续喂入业务语料。
- **提示词优化**: 调整其提示词模板，使其回复更符合部门规范。

### 3.3 绩效考核 (Performance Review)
- 系统自动记录每位数字员工的服务评价。
- 管理员定期查看 `DigitalEmployeeKpi` 报表。
- **优胜劣汰**: 评分过低的数字员工将自动触发“重训”或“停职”逻辑。

## 4. 应用场景
- **数字前台**: 负责全天候的咨询接待与意图分诊。
- **数字运维**: 7x24 小时监控日志，发现异常自动报送并尝试修复。
- **数字财务**: 自动处理报销审核、账单核对等重复性工作。
- **数字专家组**: 在群聊中，多个数字员工协作解决复杂技术问题。
- **跨企业数字大使**: 负责企业间的业务对接，通过 B2B 协议与其他企业的数字员工交换数据。

## 5. 数字员工管理平台 (移动 App)
- **便携式管理**: 通过移动 App 随时查看“虚拟办公室”的运作情况。
- **人工干预 (Human-in-the-loop)**: 当数字员工遇到无法解决的难题（意图识别度低）时，自动向 App 推送求助通知，管理者可实时接管对话。
- **技能市场**: 在手机上为数字员工购买、订阅或升级最新的 AI 技能插件。

## 6. 技术实现细节 (Technical Implementation)

### 6.1 认知记忆引擎 (Cognitive Memory)
- **自动事实提取 (Fact Extraction)**: 系统在对话结束时会自动通过 AI 提取关键事实（如用户偏好、身份信息等）。
- **定期固化与总结 (Consolidation)**: **[新增]** 定期将零散的事实记忆聚类总结为“核心认知”，优化长期存储与上下文注入。
- **自主学习 (Autonomous Learning)**: **[新增]** 支持通过 URL 或文件（PDF/Word/Excel 等）主动摄取外部知识，扩展其专业背景。
- **向量检索增强 (RAG)**: 结合 pgvector 插件，实现毫秒级的语义记忆检索。
- **上下文自动注入**: 在 `Chat` 流程中自动注入相关的记忆片段，确保对话的连贯性。

### 6.2 绩效与薪资系统 (KPI & Salary)
- **虚拟薪资 (Salary/Token)**: 将 AI 消耗的 Token 实时转换为虚拟薪资成本，支持 `salary_token` 字段的原子累加。
- **预算与重置 (Budgeting)**: **[新增]** 支持设定薪资上限 (Salary Limit)，并允许管理员在管理终端进行 Token 重置或追加预算。
- **KPI 自动聚合**: 支持多维度 KPI 指标记录，系统会自动计算并更新员工的平均 KPI 分数。
- **在线状态追踪**: 与 WebSocket 挂钩，实时更新员工的 `online_status`（online/offline/busy）。

### 6.3 技能与权限 (Skills & Permissions)
- **MCP 集成**: 支持跨企业的 MCP 工具调用，权限校验涵盖 Bot、User 和 Org 三个维度。
- **精细化授权**: `SkillManager` 提供 `CheckPermission` 接口，支持对核心技能和第三方插件的细粒度控制。

### 6.4 企业间协作 (B2B Enterprise Mesh)
- **双向 JWT 握手**: 企业间建立连接时需经过双向签名校验，确保通信安全。
- **技能审批流 (Approval Workflow)**: **[新增]** 引入多级安全审批机制，所有跨企业调用的技能必须经过目标企业显式授权 (Approved) 后方可执行。
- **连接自动化**: 握手成功后自动建立 `B2BConnection` 记录，开启跨企业工具调用权限。

## 7. 数据模型设计
- **`digital_employees`**: 存储员工档案、职位、所属企业、累积成本及**实时在线状态**。
- **`cognitive_memories`**: 存储提取出的事实片段及其向量表示 (`embedding`)。
- **`digital_employee_kpis`**: 存储量化的绩效指标与评分记录，支持 AVG 聚合。
- **`b2b_connections`**: 存储企业间已建立的互信连接、握手状态及通信协议。
- **`bot_skill_permissions`**: 存储机器人与技能/工具之间的显式授权关系。
