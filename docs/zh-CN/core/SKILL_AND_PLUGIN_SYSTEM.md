# 插件与技能系统全景概览 (Skill & Plugin System)

> [⬅️ 返回文档中心](README.md) | [🏠 返回项目主页](../../README.md)

BotMatrix 并非简单的消息转发工具，而是一个 **AI 技能孵化平台** 与 **高度可扩展的插件生态系统**。本系统通过“技能中心”赋予 AI 认知能力，通过“插件系统”赋予机器人执行能力，实现了“大脑”与“肢体”的完美结合。

---

## 1. 技能中心 (Skill Center)

技能中心是机器人能力的“应用商店”与“进化实验室”，负责技能的发现、分发、挂载与持续训练。

### 1.1 技能商店 (Skill Store)
- **技能货架**: 展示系统预置技能（如：智能翻译、代码评审）与用户自定义技能。
- **一键挂载**: 用户可以将技能直接绑定到特定的机器人实例或群组。
- **热插拔设计**: 技能的开启与关闭即时生效，无需重启任何服务。
- **隔离机制**: 租户间的技能完全隔离，支持私有技能、组织内共享技能与全局公开技能。

### 1.2 技能训练中心 (Skill Training Center)
- **提示词 (Prompt) IDE**: 
    - 可视化编辑 System Prompt 与 User Prompt。
    - 支持变量动态注入（如：`{{.UserName}}`, `{{.LastMessage}}`）。
- **语料标注与纠错**: 自动抓取 AI 回复效果不佳的对话，转化为 Few-shot 示例进行微调。
- **RAG 实验室**: 在线管理知识库文档 (PDF, Markdown, Docx)，调试分段策略。

---

## 2. 插件系统架构 (Plugin Architecture)

BotMatrix 采用跨平台、进程级的插件架构，支持多语言（Go, Python, JS, C#）开发。

### 2.1 核心组件
1. **插件管理器 (Plugin Manager)**: 管理插件生命周期（启动、停止、重启）、发现与配置。
2. **进程管理器 (Process Manager)**: 管理插件进程，通过 `stdin/stdout` 实现 JSON 进程间通信。
3. **安全策略 (Security Policy)**: 
    - **权限裁决**: 细粒度的权限控制（如 `send_message`, `call_skill`）。
    - **沙箱隔离**: 插件运行在独立的 OS 进程中，通过权限白名单限制其操作。

### 2.2 跨插件调用 (Skill Call)
引入基于 `CorrelationID` 的异步调用机制：
1. **调用方**：发送 `call_skill` Action，包含目标插件 ID、技能名及参数。
2. **内核**：路由请求至目标插件。
3. **响应方**：执行逻辑并返回结果。
4. **回传**：通过 `skill_result` 事件将结果回传给调用方。

---

## 3. 核心插件 (Nexus Core Plugin)

`CorePlugin` 是集成在 `BotNexus` 消息路由层的系统级核心插件，负责在消息转发到 Worker 之前进行裁决。

- **消息流控制**: 支持全局开启/关闭系统、维护模式。
- **权限与过滤**: 多维度黑白名单（用户、机器人、群组）及敏感词过滤。
- **管理员指令**: 
    - `/system status`: 查看运行统计。
    - `/system open/close`: 开启或拦截系统消息。
    - `/system whitelist/blacklist`: 动态管理名单。

---

## 4. 插件市场与规范 (BMPK Standard)

为了实现标准化的分发，BotMatrix 定义了插件包 (**BMPK**) 格式。

- **BMPK 格式**: 包含 `plugin.json` (元数据)、执行主体 (`bin/` 或 `src/`) 及安装脚本。
- **元数据规范**: 声明 `id`, `category`, `permissions`, `intents` 等关键字段。
- **收益模型**: 支持免费、买断、订阅及基于 API 计费的多种商业模式。

---

## 5. 兼容性与功能开关

系统通过“功能开关控制”与“能力动态发现”确保新旧版本的平滑过渡。

- **全局开关**: 通过 `ENABLE_SKILL=true` 环境变量或 WebUI 后台控制。
- **能力报备**: 只有报备了特定 `capabilities` 的 Worker 才会接收到对应的技能调用任务。
- **降级路由**: 当技能系统关闭时，系统自动回退到传统的 OneBot 消息转发模式。

---

## 6. 插件生态概览

目前系统已内置及支持以下插件分类：

- **核心系统**: 管理、黑名单、高级治理 (Admin System V2)。
- **社交互动**: 婚姻系统、问候语、社交分流。
- **游戏娱乐**: 育儿、宠物、钓鱼、成就、积分系统。
- **实用工具**: 翻译、天气、系统信息查询。

---

## 7. 开发者相关

- **开发指南**: 请参考 [PLUGIN_DEVELOPMENT.md](../plugins/PLUGIN_DEVELOPMENT.md)。
- **SDK 指南**: 请参考 [sdk_guide.md](../plugins/sdk_guide.md)。
- **重构规范**: 2026 年重构后的插件需对齐 `IModuleMetadata` 接口。

---
*最后更新日期：2026-01-13*
